# AI データ分析アシスタント

CSV をアップロードするだけで、AI が自律的にデータ分析を行い、グラフ付きの洞察レポートを生成する Streamlit アプリケーションです。

## 🌟 特徴

- **自動データ分析**: CSV ファイルをアップロードするだけで、AI が自動的にデータの特性を把握し、適切な分析を実行
- **インテリジェントなコード生成**: LangGraph と OpenAI API を使用して、データに最適な分析コードを動的に生成
- **インタラクティブなグラフ**: Plotly を使用した美しく分かりやすいグラフを自動生成
- **包括的なレポート**: 分析結果に基づいた洞察に富んだレポートを自動作成
- **エラーハンドリング**: コード実行時のエラーを自動的に検出・修正

## 🏗️ アーキテクチャ

本アプリケーションは以下のコンポーネントで構成されています：

### フロントエンド

- **Streamlit**: ユーザーフレンドリーな Web インターフェース

### バックエンド（AI エージェント）

- **LangGraph**: AI エージェントのワークフロー管理
- **OpenAI API**: 自然言語処理とコード生成
- **Pandas**: データ処理と分析
- **Plotly**: インタラクティブなグラフ生成

### AI エージェントのワークフロー

1. **状況把握ノード**: データの前処理と概要把握
2. **プランナーノード**: データに基づいた分析計画の立案
3. **コーダーノード**: 分析タスクに対応する Python コードの生成
4. **コード実行ノード**: 生成されたコードの安全な実行
5. **コード修正ノード**: エラー発生時の自動修正
6. **報告ノード**: 分析結果に基づくレポート生成
7. **レビューノード**: レポートの最終チェックと改善

## 📋 必要条件

- Python 3.8 以上
- OpenAI API キー

## 🚀 インストールと実行

### 1. リポジトリのクローンまたはダウンロード

```bash
git clone <repository-url>
cd analyze
```

### 2. 自動セットアップ（推奨）

**Windows:**

```bash
setup.bat
```

**Linux/Mac:**

```bash
chmod +x setup.sh
./setup.sh
```

### 3. 手動セットアップ

```bash
# 仮想環境の作成
python -m venv venv

# 仮想環境のアクティベート
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

# 依存関係のインストール
pip install -r requirements.txt
```

### 4. 環境変数の設定

`.env` ファイルを編集して OpenAI API キーを設定：

```env
OPENAI_API_KEY=your_openai_api_key_here
```

### 5. アプリケーションの起動

```bash
streamlit run app.py
```

ブラウザで `http://localhost:8501` にアクセスしてアプリケーションを使用できます。

## 📁 ファイル構成

```
analyze/
├── app.py              # Streamlit UI
├── agent.py            # LangGraph AIエージェント
├── tools.py            # データ分析用ツール関数
├── requirements.txt    # Python依存関係
├── .env               # 環境変数設定
├── setup.sh           # Linux/Mac用セットアップスクリプト
├── setup.bat          # Windows用セットアップスクリプト
├── design.md          # 設計仕様書
└── README.md          # このファイル
```

## 🎯 使用方法

1. **OpenAI API キーの設定**: サイドバーで API キーを入力
2. **CSV ファイルのアップロード**: 分析したい CSV ファイルを選択
3. **分析開始**: 「分析開始」ボタンをクリック
4. **結果の確認**:
   - **レポートタブ**: AI 生成の洞察レポート
   - **グラフタブ**: 自動生成されたビジュアライゼーション
   - **詳細結果タブ**: 実行されたコードと詳細な分析結果

## 🔧 カスタマイズ

### 分析タスクの追加

`tools.py` の `generate_analysis_tasks()` 関数と `create_analysis_code()` 関数を修正することで、新しい分析タスクを追加できます。

### UI のカスタマイズ

`app.py` を修正して、ユーザーインターフェースをカスタマイズできます。

### AI モデルの変更

`agent.py` の `DataAnalysisAgent` クラスで OpenAI モデルを変更できます：

```python
agent = DataAnalysisAgent(
    openai_api_key=api_key,
    model_name="gpt-4o"  # または "gpt-4.1"
)
```

## 🔒 セキュリティ

- コード実行は制限された環境で行われます
- 危険な操作（ファイル操作、ネットワークアクセスなど）は制限されています
- ユーザーの DataFrame はコピーが作成され、元データは保護されます

## 🐛 トラブルシューティング

### よくある問題

1. **インポートエラー**: 依存関係が正しくインストールされているか確認してください
2. **OpenAI API エラー**: API キーが正しく設定されているか確認してください
3. **メモリエラー**: 大きなデータセットの場合、サンプリングして分析することを検討してください

### ログの確認

Streamlit アプリケーションはコンソールにログを出力します。エラーが発生した場合は、コンソールのログを確認してください。

## 🤝 貢献

プルリクエストやイシューの報告を歓迎します。新機能の追加や改善案がありましたら、お気軽にご提案ください。

## 📄 ライセンス

このプロジェクトは MIT ライセンスの下で公開されています。

## 🔮 今後の改善予定

- [ ] より多くの分析タイプの対応
- [ ] 予測モデリング機能の追加
- [ ] ダッシュボード機能の強化
- [ ] エクスポート機能の改善
- [ ] 多言語対応
- [ ] クラウドデプロイメント対応

## 📞 サポート

質問やサポートが必要な場合は、GitHub の Issues ページでお知らせください。
